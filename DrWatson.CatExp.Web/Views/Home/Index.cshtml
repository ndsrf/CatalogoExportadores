<script src="/Scripts/jquery.signalR-2.0.0.min.js"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="/signalr/hubs"></script>

<script type="text/html" id="display">
    <td data-bind="text: nombre"></td>
    <td data-bind="text: telefono"></td>
    <td>
        <button class="btn btn-success kout-edit" data-bind="click: setEditMode">Editar</button>
        <button class="btn btn-danger kout-delete" data-bind="click: $root.borrarExportador.bind($root)">Borrar</button>
    </td>
</script>

<script type="text/html" id="edit">
    <td><input type="text" data-bind="value: nombre" /></td>
    <td><input type="text" data-bind="value: telefono" /></td>
    <td>
        <button class="btn btn-success kout-save" data-bind="click: grabar">Grabar</button>
        <button class="btn btn-danger kout-cancel" data-bind="click: cancelar">Cancelar</button>
    </td>
</script>

    <div class="jumbotron">
        <h1>Catálogo de Exportadores</h1>
        <p class="lead">Esta página contiene operaciones CRUD sobre una lista de entidades "Exportadores".</p>
    </div>

<div class='CatalogoExportadoresSection'>
    <p>
        <button class="btn btn-primary" id="create" data-bind="click: crearNuevoExportador">Crear nuevo exportador</button>
    </p>
    <table class="table">
        <thead>
            <tr><th>Nombre</th><th>Telefono</th></tr>
        </thead>
        <tbody data-bind="foreach: exportadores">
            <tr data-bind="template: { name: mode, data: $data}"></tr>
        </tbody>
        <tfoot>
            <tr>
                <td colspan="7">
                    <button data-bind="click: previousPage" class="btn"><i class="icon-step-backward"></i></button>
                    Page<label data-bind="text: currentPageIndex() + 1" class="badge"></label>
                    <button data-bind="click: nextPage" class="btn"><i class="icon-step-forward"></i></button>
                </td>
            </tr>
        </tfoot>
    </table>
    <div id='cargandoListaExportadores'><img src='/Content/images/ajax-loader.gif' /></div>
</div>


<div class="container">
    <input type="button" id="btnImportar" value="Importar" />
    <ul id="status"></ul>
</div>

<script src="/scripts/require.js"></script>
<script type="text/javascript">
    require.config(
    {
        baseUrl: "/Scripts/",
        paths: {
            jquery: "jquery-2.0.3",
            knockout: "knockout-3.0.0",
            komapping: "knockout.mapping"
    },
        shim: {
            komapping: {
                deps: ['knockout'],
                exports: 'komapping'
            }
        }
    });
    requirejs(['catalogoexportadores']);



    $(function () {
        // Declare a proxy to reference the hub. 
        var catExpHub = $.connection.catExpImportHub;
        // Create a function that the hub can call to broadcast messages.
        catExpHub.client.displayMessage = function (source, message) {
            // Html encode display name and message. 
            var encodedSource = $('<div />').text(source).html();
            var encodedMsg = $('<div />').text(message).html();
            // Add the message to the page. 
            $('#status').append('<li><strong>' + encodedSource
                + '</strong>:&nbsp;&nbsp;' + encodedMsg + '</li>');
        };


        // Start the connection.
        $.connection.hub.start().done(function () {
            $('#btnImportar').click(function () {
                catExpHub.server.processImport(5);
            });
        });
    });

</script>

